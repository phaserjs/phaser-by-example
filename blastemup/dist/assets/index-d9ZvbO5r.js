import{P as s}from"./phaser-CmFXOKba.js";!function(){const s=document.createElement("link").relList;if(!(s&&s.supports&&s.supports("modulepreload"))){for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver((s=>{for(const e of s)if("childList"===e.type)for(const s of e.addedNodes)"LINK"===s.tagName&&"modulepreload"===s.rel&&t(s)})).observe(document,{childList:!0,subtree:!0})}function t(s){if(s.ep)return;s.ep=!0;const t=function(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),"use-credentials"===s.crossOrigin?t.credentials="include":"anonymous"===s.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(s);fetch(s.href,t)}}();class t extends Phaser.GameObjects.Rectangle{constructor(s,t,e,i=16777215,a=4,o=1){super(s,t,e,a,a,i,o),this.name="bubble",this.scene=s,this.alpha=o,this.setOrigin(.5),s.add.existing(this),s.physics.add.existing(this),this.body.setAllowGravity(!1),this.init()}init(){this.scene.tweens.add({targets:this,duration:Phaser.Math.Between(600,1e3),scale:{from:1,to:3},alpha:{from:this.alpha,to:0},onComplete:()=>{this.destroy()}})}}class e extends Phaser.GameObjects.Sprite{constructor(s,t,e,i){super(s,t,e,"ship1_1"),this.scene=s,this.name=i,this.tint=16777215*Math.random(),s.add.existing(this),s.physics.add.existing(this),this.body.setAllowGravity(!1),this.body.setCircle(26),this.body.setOffset(6,9),this.body.setBounce(.8),this.angle=0,this.speed=0,this.friction=.95,this.death=!1,this.init()}init(){this.cursor=this.scene.input.keyboard.createCursorKeys(),this.scene.events.on("update",this.update,this),this.body.setDrag(300),this.body.setAngularDrag(400),this.body.setMaxVelocity(600),this.upDelta=0}get key(){return this.name.split(":")[1]}update(s,e){this.death||(this.cursor.left.isDown?this.body.setAngularVelocity(-150):this.cursor.right.isDown?this.body.setAngularVelocity(150):this.body.setAngularVelocity(0),this.cursor.up.isDown?(this.upDelta+=e,this.upDelta>200&&(this.upDelta=0),this.body.setVelocity(300*Math.cos(this.rotation),300*Math.sin(this.rotation))):this.body.setAcceleration(0),Phaser.Math.Between(1,4)>1&&this.scene.thrust.add(new t(this.scene,this.x,this.y,16777215,10)))}destroy(){this.death=!0,super.destroy()}}const i="newPlayer",a="playerDisconnected";class o extends s.Scene{constructor(){super({key:"game"})}create(){this.id=null,this.startSockets(),this.loadAudios(),this.addColliders()}startSockets(){this.socket=io(),this.addPlayer(),this.enemies={},this.enemyPlayers=this.physics.add.group(),this.socket.on(i,function(s){this.addEnemyPlayers(s)}.bind(this)),this.socket.on("currentPlayers",function(s){Object.keys(s).forEach((t=>{this.enemies[t]||t===this.player.key||this.addEnemyPlayers(s[t])}))}.bind(this)),this.socket.on("playerMoved",function(s){const[t,e]=s.name.split(":");this.enemies[e]&&(this.enemies[e].setRotation(s.rotation),this.enemies[e].setPosition(s.x,s.y))}.bind(this)),this.socket.on(a,function(s){this.enemyPlayers.getChildren().forEach((function(t){s===t.key&&t.destroy()}))}.bind(this))}addEnemyPlayers(s){const[t,i]=s.name.split(":");console.log("Adding enemy player! ",s.name," Against ",i);const a=new e(this,s.x,s.y,s.name);this.enemies[a.key]=a,this.enemyPlayers.add(a)}addPlayer(){this.thrust=this.add.layer();const t=600+s.Math.Between(-100,100),a=500+s.Math.Between(-100,100);this.player=new e(this,t,a,"MyName:"+crypto.randomUUID()),console.log("Creating player! ",this.player.key),this.socket.emit(i,this.player),this.setCamera()}setCamera(){this.cameras.main.setBackgroundColor(13421772),this.cameras.main.startFollow(this.player,!0,.05,.05,0,100)}addColliders(){this.physics.add.overlap(this.player,this.enemyPlayers,this.playerCollision.bind(this))}playerCollision(s,t){console.log("Collision! "),this.socket.emit(a,s.key),s.destroy(),t.destroy()}update(){if(this.player){const s={x:this.player.x,y:this.player.y,rotation:this.player.rotation};!this.player.oldPosition||s.x===this.player.oldPosition.x&&s.y===this.player.oldPosition.y&&s.rotation===this.player.oldPosition.rotation||this.socket.emit("playerIsMoving",{key:this.player.key,...s}),this.player.oldPosition=s}}loadAudios(){this.audios={pick:this.sound.add("pick"),shot:this.sound.add("shot"),foeshot:this.sound.add("foeshot"),explosion:this.sound.add("explosion"),asteroid:this.sound.add("asteroid")}}playAudio(s){this.audios[s].play({volume:.2})}startGame(){this.theme&&this.theme.stop(),this.scene.start("game")}destroy(){this.player&&this.socket.emit(a,this.player.key),super.destroy()}}class r extends Phaser.Scene{constructor(){super({key:"bootloader"})}preload(){this.createBars(),this.load.on("progress",(function(s){this.progressBar.clear(),this.progressBar.fillStyle(8966732,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*s,16)}),this),this.load.on("complete",(()=>{this.scene.start("game")}),this),Array(6).fill(0).forEach(((s,t)=>{this.load.audio(`muzik${t}`,`assets/sounds/muzik${t}.mp3`)})),this.load.image("ship1_1","assets/images/starship.png"),this.load.image("foeship","assets/images/foeship.png"),this.load.image("pello","assets/images/pello.png"),this.load.image("hex","assets/images/hex64.png"),this.load.image("asteroid","assets/images/asteroid.png"),this.load.audio("splash","assets/sounds/splash.mp3"),this.load.audio("game-over","assets/sounds/game-over.mp3"),this.load.audio("explosion","assets/sounds/explosion.mp3"),this.load.audio("shot","assets/sounds/shot.mp3"),this.load.audio("foeshot","assets/sounds/foeshot.mp3"),this.load.audio("pick","assets/sounds/pick.mp3"),this.load.audio("asteroid","assets/sounds/asteroid.mp3"),this.load.bitmapFont("arcade","assets/fonts/arcade.png","assets/fonts/arcade.xml"),this.load.bitmapFont("wendy","assets/fonts/arcade.png","assets/fonts/wendy.xml"),this.load.bitmapFont("starshipped","assets/fonts/starshipped.png","assets/fonts/starshipped.xml"),this.load.spritesheet("shot","assets/images/shot.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("shotfoe","assets/images/shotfoe.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("energy","assets/images/energy.png",{frameWidth:32,frameHeight:32})}create(){}createBars(){this.loadBar=this.add.graphics(),this.loadBar.fillStyle(33923,1),this.loadBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const h={type:s.AUTO,useTicker:!0,scale:{mode:s.Scale.FIT,parent:"phaser-example",autoCenter:s.Scale.CENTER_BOTH,width:868,height:800},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[r,o]};new s.Game(h);
